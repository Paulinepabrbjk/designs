const jscad = require('@jscad/modeling')
const { curves, maths, extrusions, primitives, transforms, booleans, 
	colors, geometries, measurements, utils } = jscad
const { bezier } = curves
const { slice, extrudeLinear } = extrusions
const { cuboid, polygon, polyhedron } = primitives
const { intersect, subtract,union } = booleans
const { center, scale, translateX, translateY, translateZ, translate
		,rotateX, rotateY, rotateZ } = transforms
const { colorize } = colors
const { geom3, poly3 } = geometries
const { vec3 } = maths
const { measureBoundingBox, measureArea } = measurements
const { degToRad } = utils

const getParameterDefinitions = () => {
  return [
    {name: 'g1', caption: 'Lignes', type: 'group'},
    {name: 'l0', caption: '#1:', type: 'slider', min:"0", max:"100", step:"1", initial:"50"},
    {name: 'l1', caption: '#2:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l2', caption: '#3:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l3', caption: '#4:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l4', caption: '#5:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l5', caption: '#6:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l6', caption: '#7:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l7', caption: '#8:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l8', caption: '#9:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'l9', caption: '#10:',type: 'slider', min:"0", max:"100", step:"1", initial:"0"},

    {name: 'g2', caption: 'Colonnes', type: 'group'},
    {name: 'c0', caption: '#1:', type: 'slider', min:"0", max:"100", step:"1", initial:"50"},
    {name: 'c1', caption: '#2:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c2', caption: '#3:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c3', caption: '#4:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c4', caption: '#5:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c5', caption: '#6:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c6', caption: '#7:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c7', caption: '#8:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c8', caption: '#9:', type: 'slider', min:"0", max:"100", step:"1", initial:"0"},
    {name: 'c9', caption: '#10:',type: 'slider', min:"0", max:"100", step:"1", initial:"0"},

    {name: 'g3', caption: 'Parametres', type: 'group'},
    //,{name: 'v', type:'text', caption: 'volume:', initial: 'test'}
    ,{name: 'ep', type:'float', caption: 'ep (mm):', initial: 6.0}    

   ];
}

volume = function () {
  const faces =[[0,4,61],[0,316,34],[1,37,35],[1,104,5],[1,314,317],[1,317,102],[2,8,6],[2,34,60],[3,37,7],[3,110,35],[3,121,103],[4,34,36],[4,45,59],[5,37,1],[5,104,37],[6,34,2],[6,45,36],[6,56,58],[7,10,3],[7,105,10],[8,29,11],[8,49,26],[8,60,57],[9,3,10],[9,27,121],[10,27,9],[10,105,106],[10,115,28],[11,6,8],[11,29,56],[12,153,154],[12,155,30],[13,27,31],[13,151,27],[14,55,18],[15,41,19],[15,118,120],[15,301,321],[15,318,39],[16,54,38],[17,24,21],[17,41,39],[17,107,23],[17,112,119],[18,38,14],[18,43,40],[18,55,53],[19,41,118],[19,118,15],[20,22,16],[20,38,40],[20,43,52],[20,50,25],[21,24,117],[21,41,17],[21,117,41],[22,20,25],[22,33,30],[22,47,51],[22,54,16],[23,32,24],[23,107,31],[24,17,23],[24,32,116],[25,33,22],[25,50,33],[26,29,8],[26,153,12],[27,142,108],[27,151,152],[28,27,10],[28,115,32],[29,26,33],[29,46,48],[30,26,12],[30,47,22],[30,155,47],[31,27,32],[31,32,23],[31,107,109],[31,143,150],[31,151,13],[32,27,28],[32,115,114],[33,26,30],[33,46,29],[33,50,46],[34,4,0],[34,310,44],[34,316,315],[35,37,3],[35,298,314],[35,314,1],[36,34,6],[36,45,4],[37,104,113],[37,105,7],[38,20,16],[38,54,42],[38,312,319],[38,320,14],[39,41,15],[39,112,17],[39,318,112],[40,38,18],[40,43,20],[41,117,111],[42,312,38],[43,53,122],[44,60,34],[44,310,70],[45,124,126],[46,128,48],[46,129,127],[47,147,69],[47,155,148],[48,56,29],[48,128,56],[49,81,68],[49,146,149],[49,153,26],[50,129,46],[51,47,67],[51,54,22],[52,50,20],[52,122,130],[52,129,50],[53,43,18],[54,67,79],[54,72,42],[55,131,53],[55,309,80],[55,320,313],[56,6,11],[56,128,123],[57,49,8],[57,81,49],[58,45,6],[58,56,124],[59,45,125],[59,61,4],[60,8,2],[60,70,63],[60,81,57],[61,125,62],[61,308,311],[61,316,0],[62,89,91],[62,125,64],[62,304,308],[62,308,61],[63,70,90],[63,81,60],[64,73,89],[64,125,73],[65,66,88],[65,124,66],[66,95,87],[66,124,123],[67,54,51],[67,84,86],[67,99,79],[68,81,85],[68,146,49],[69,67,47],[69,147,84],[70,60,44],[70,302,83],[70,310,306],[71,78,82],[71,122,78],[72,99,92],[72,303,307],[72,312,42],[73,88,93],[73,124,65],[73,125,126],[74,95,75],[74,96,94],[74,128,127],[75,66,128],[75,95,66],[76,74,129],[76,96,74],[77,82,97],[77,96,76],[77,122,71],[77,129,130],[78,100,98],[78,122,131],[79,72,54],[79,99,72],[80,100,78],[80,131,55],[81,90,101],[82,77,71],[82,98,132],[82,140,97],[83,90,70],[83,302,110],[84,67,69],[84,143,109],[84,147,145],[85,121,108],[85,142,144],[85,146,68],[86,84,107],[86,99,67],[87,88,66],[87,95,133],[88,73,65],[88,133,134],[88,136,93],[89,62,64],[89,136,135],[90,81,63],[90,110,103],[90,121,101],[91,135,102],[91,304,62],[92,303,72],[93,89,73],[93,136,89],[94,95,74],[94,137,95],[95,137,138],[96,137,94],[96,140,139],[97,96,77],[97,140,96],[98,82,78],[99,107,119],[99,112,92],[100,141,98],[100,301,120],[100,309,305],[101,85,81],[101,121,85],[102,104,1],[102,135,104],[102,304,91],[102,317,300],[103,110,3],[103,121,90],[105,133,106],[105,136,134],[106,115,10],[106,133,115],[107,99,86],[108,121,27],[108,142,85],[109,107,84],[109,143,31],[110,90,83],[110,298,35],[110,302,298],[111,118,41],[111,132,118],[112,303,92],[112,318,299],[113,104,136],[113,105,37],[114,115,137],[114,116,32],[115,133,138],[116,117,24],[116,137,139],[117,116,140],[117,132,111],[118,132,141],[119,107,17],[119,112,99],[120,141,100],[120,301,15],[121,3,9],[122,52,43],[123,124,56],[123,128,66],[124,45,58],[125,61,59],[126,124,73],[126,125,45],[127,128,46],[127,129,74],[128,74,75],[129,77,76],[130,122,77],[130,129,52],[131,80,78],[131,122,53],[132,140,82],[133,88,87],[134,133,105],[134,136,88],[135,91,89],[135,136,104],[136,105,113],[137,116,114],[138,133,95],[138,137,115],[139,137,96],[139,140,116],[140,132,117],[141,120,118],[141,132,98],[142,241,144],[143,187,150],[144,146,85],[144,241,146],[145,143,84],[145,240,143],[146,205,149],[147,240,145],[148,147,47],[148,203,147],[149,153,49],[149,205,153],[150,151,31],[150,187,151],[151,183,152],[152,142,27],[152,183,142],[153,168,154],[154,155,12],[154,168,155],[155,203,148],[156,160,190],[156,316,217],[157,317,191],[158,164,216],[158,190,162],[159,165,163],[159,259,165],[160,201,192],[160,217,215],[161,191,193],[161,258,157],[161,269,260],[162,164,158],[162,190,192],[162,192,214],[163,191,159],[163,262,261],[163,269,193],[164,162,167],[164,185,182],[164,205,213],[165,184,166],[165,259,277],[165,264,183],[166,163,165],[166,262,163],[167,162,212],[167,185,164],[168,153,182],[168,182,186],[169,151,187],[170,194,174],[170,211,320],[170,320,194],[171,197,195],[171,274,175],[171,301,276],[172,176,194],[172,178,176],[172,210,178],[173,197,177],[173,263,275],[173,268,195],[174,194,196],[174,199,209],[174,211,170],[175,197,171],[176,208,196],[177,180,173],[178,189,181],[178,203,186],[178,210,207],[179,173,180],[179,263,173],[180,187,179],[180,270,188],[180,273,272],[181,176,178],[181,202,206],[181,208,176],[182,153,205],[182,205,164],[183,151,169],[183,184,165],[184,183,188],[184,262,166],[184,270,271],[185,202,189],[185,212,204],[186,155,168],[186,182,189],[186,189,178],[187,143,265],[187,183,169],[187,263,179],[188,183,187],[188,187,180],[188,270,184],[189,182,185],[189,202,181],[190,216,200],[190,316,156],[191,161,157],[191,259,159],[191,298,266],[192,190,160],[193,191,163],[193,269,161],[194,210,172],[194,312,198],[195,197,173],[195,318,171],[196,194,176],[196,199,174],[196,208,199],[197,273,177],[197,274,267],[198,210,194],[198,228,210],[198,312,228],[199,208,278],[199,287,209],[200,216,226],[200,310,190],[201,214,192],[201,282,214],[202,284,283],[202,285,206],[203,155,186],[203,223,225],[204,202,185],[204,284,202],[205,146,224],[205,237,213],[206,208,181],[206,285,208],[207,203,178],[207,210,223],[208,285,286],[209,211,174],[209,287,211],[210,228,235],[211,287,236],[212,185,167],[212,214,279],[212,284,204],[213,216,164],[213,237,216],[214,212,162],[214,282,280],[215,201,160],[215,217,281],[215,282,201],[216,190,158],[216,237,219],[217,160,156],[217,308,218],[218,281,217],[218,308,247],[219,226,216],[219,237,246],[220,247,245],[220,249,229],[220,281,218],[220,282,281],[221,249,244],[221,279,280],[222,221,243],[222,251,231],[222,279,221],[223,203,207],[223,255,242],[224,146,241],[224,237,205],[225,147,203],[225,223,240],[226,219,239],[226,310,200],[227,233,238],[227,278,233],[228,255,235],[228,303,248],[229,221,282],[229,249,221],[230,250,232],[230,251,250],[230,285,283],[231,230,284],[231,251,230],[231,279,222],[232,233,285],[232,250,252],[232,252,233],[233,252,253],[233,278,286],[234,236,287],[234,238,254],[234,256,236],[234,278,227],[235,223,210],[235,255,223],[236,256,309],[236,309,211],[237,241,257],[238,234,227],[238,253,288],[238,297,254],[239,259,266],[239,302,226],[240,147,225],[240,263,265],[241,142,264],[241,237,224],[241,277,257],[242,240,223],[242,255,263],[243,251,222],[243,290,289],[243,294,251],[244,243,221],[244,249,290],[245,247,291],[245,249,220],[246,239,219],[246,257,259],[247,220,218],[247,304,258],[248,255,228],[248,268,255],[248,303,268],[249,291,292],[250,294,293],[250,295,252],[251,294,250],[252,295,253],[253,238,233],[253,295,296],[254,256,234],[254,297,256],[255,268,275],[256,297,276],[257,246,237],[258,291,247],[258,317,157],[259,239,246],[260,258,161],[260,291,258],[261,269,163],[261,290,269],[262,290,261],[262,294,289],[263,240,242],[264,142,183],[264,277,241],[265,143,240],[265,263,187],[266,259,191],[266,298,239],[267,273,197],[267,288,273],[268,318,195],[269,290,292],[269,291,260],[270,295,293],[271,262,184],[271,270,294],[272,270,180],[272,273,295],[273,180,177],[273,288,296],[274,197,175],[274,276,297],[274,288,267],[275,263,255],[275,268,173],[276,274,171],[276,301,256],[277,259,257],[277,264,165],[278,287,199],[279,284,212],[280,279,214],[280,282,221],[281,282,215],[282,220,229],[283,284,230],[283,285,202],[284,279,231],[285,230,232],[286,278,208],[286,285,233],[287,278,234],[288,297,238],[289,290,262],[289,294,243],[290,243,244],[291,249,245],[292,290,249],[292,291,269],[293,294,270],[293,295,250],[294,262,271],[295,270,272],[296,288,253],[296,295,273],[297,288,274],[298,191,314],[299,268,303],[299,303,112],[300,258,304],[300,304,102],[301,171,321],[302,239,298],[303,228,307],[304,247,308],[305,256,301],[305,301,100],[306,226,302],[306,302,70],[307,228,312],[307,312,72],[308,217,311],[309,100,80],[309,256,305],[310,226,306],[311,217,316],[311,316,61],[312,194,319],[313,211,309],[313,309,55],[314,191,317],[315,190,310],[315,310,34],[316,190,315],[317,258,300],[318,268,299],[319,194,320],[319,320,38],[320,55,14],[320,211,313],[321,171,318],[321,318,15]]
  const vertices = [[68.06045896,-174.3848768,-124.0338439],[68.06045896,-174.3848768,124.3819181],[111.12277966,-116.71139028,-107.99372844],[111.15487638,-116.68147524,108.39751094],[115.15535636,-172.5948768,-122.0666339],[115.15535636,-172.5948768,122.4147081],[117.39023136,-114.3848768,-117.97313365],[117.39023136,-114.3848768,118.32120785],[105.66236436,-56.41444694,-134.51354989],[105.27706366,-56.44636182,134.65272137],[122.83885717,-62.40311834,142.9365984],[123.69195919,-62.13497878,-143.41835887],[59.4860163,0.31053707,-134.46387982],[58.54932648,0.34651637,132.95627937],[68.06045896,174.8751232,-124.0338439],[68.06045896,174.8751232,124.3819181],[110.99238041,117.26882958,-107.53105712],[111.02641423,117.23904762,107.93396853],[115.15535636,173.0851232,-122.0666339],[115.15535636,173.0851232,122.4147081],[117.39023136,114.8751232,-117.97313365],[117.39023136,114.8751232,118.32120785],[105.72997729,56.99647957,-134.6770231],[105.34591267,57.03326384,134.81903409],[122.83885717,62.89336474,142.9365984],[123.69195919,62.62522518,-143.41835887],[94.76523302,-11.55058566,-134.56373374],[94.02284569,-11.43864331,132.50343544],[121.42935878,-17.24879482,132.28018069],[126.62129832,-16.04855335,-134.89749315],[94.89011784,14.63416538,-135.51327449],[94.15883402,14.63416538,133.42548683],[121.42935879,17.99565077,133.63444518],[126.60057722,16.95919948,-136.19145552],[96.04308064,-154.62304991,-108.82214371],[96.04308064,-154.62304991,109.17021791],[117.55935636,-149.7548768,-117.6838219],[117.55935636,-149.7548768,118.0318961],[95.6725758,155.51936399,-108.00077324],[95.6725758,155.51936399,108.34884744],[117.55935636,150.2451232,-117.6838219],[117.55935636,150.2451232,118.0318961],[87.22266767,155.51936399,-84.99470969],[129.83634323,150.14731517,-97.14020788],[87.46869799,-154.62304991,-85.44889847],[129.83634323,-149.65706876,-97.14020788],[145.3448491,17.44044613,-104.79279183],[83.66955248,14.63416538,-91.47232025],[145.3448491,-16.95019972,-104.79279183],[83.56235244,-15.50418059,-91.29938202],[138.61477756,62.73037074,-102.19554582],[94.76101889,57.56735709,-91.02108057],[130.12628263,114.92244857,-98.17182083],[122.14375245,174.68950358,-95.48312701],[102.20040484,118.96168189,-87.02402262],[70.32881253,180.14799512,-92.88724872],[138.61477756,-62.24012434,-102.19554582],[94.7185637,-56.72674465,-91.09511143],[130.12628263,-114.43220217,-98.17182083],[122.14375245,-174.19925717,-95.48312701],[102.12843598,-117.87750478,-86.93189306],[70.32881253,-179.65774872,-92.88724872],[72.39283144,-179.5029473,-32.84887872],[102.12843598,-117.87750478,-32.7959629],[136.9491747,-173.08622399,-30.17097309],[148.92069141,-115.07321756,-27.2943953],[157.57056421,-62.80443345,-27.5832773],[94.76101892,57.56735729,-32.79596298],[83.43309488,-15.02656967,-32.7959629],[83.60831406,14.63416538,-32.79542188],[87.46681351,-154.62304991,-32.7959629],[148.74350968,149.13403034,-27.29761079],[87.06157278,155.51936399,-32.7959629],[148.74350968,-148.64378394,-27.29761079],[164.82328506,17.07642011,-28.71974987],[164.82328506,-16.58617371,-28.71974987],[157.57056421,63.29467985,-27.5832773],[148.92069141,115.56346396,-27.2943953],[136.9491747,173.57647039,-30.17097309],[102.20040484,118.96168189,-32.7959629],[72.39283144,179.9931937,-32.84887872],[94.7185637,-56.72674465,-32.7959629],[148.74350968,149.13403034,27.64568499],[87.46681351,-154.62304991,33.1440371],[83.60831494,14.63416538,33.14457696],[83.43309488,-15.02656967,33.1440371],[94.76101895,57.56735753,33.14403702],[157.57056421,-62.80443345,27.9313515],[148.92069141,-115.07321756,27.6424695],[136.9491747,-173.08622399,30.51904729],[102.12843598,-117.87750478,33.1440371],[72.39283144,-179.5029473,33.19695292],[87.06157278,155.51936399,33.1440371],[148.74350968,-148.64378394,27.64568499],[164.82328506,17.07642011,29.06782407],[164.82328506,-16.58617371,29.06782407],[157.57056421,63.29467985,27.9313515],[148.92069141,115.56346396,27.6424695],[136.9491747,173.57647039,30.51904729],[102.20040484,118.96168189,33.1440371],[72.39283144,179.9931937,33.19695292],[94.7185637,-56.72674465,33.1440371],[70.32881253,-179.65774872,93.23532292],[102.12843598,-117.87750478,87.27996726],[122.14375245,-174.19925717,95.83120121],[130.12628263,-114.43220217,98.51989503],[138.18822656,-62.37419412,102.12870268],[94.761019,57.56735797,91.43308141],[83.54546283,-15.44177291,91.80489876],[83.65522078,14.63416538,91.98116391],[87.46869799,-154.62304991,85.79697267],[129.83634323,150.14731517,97.48828208],[87.22266767,155.51936399,85.34278389],[129.83634323,-149.65706876,97.48828208],[144.06519607,17.57451591,103.89611402],[144.06519607,-17.0842695,103.89611402],[138.18822656,62.86444052,102.12870268],[130.12628263,114.92244857,98.51989503],[122.14375245,174.68950358,95.83120121],[102.20040484,118.96168189,87.37209682],[70.32881253,180.14799512,93.23532292],[94.7185637,-56.72674465,91.51041378],[140.02229774,149.59502649,-66.48133558],[148.87980461,-62.5941204,-67.08338569],[140.25179004,-114.7857138,-66.47558436],[134.81114026,-171.74253171,-66.4082809],[140.02229774,-149.10478009,-66.48133558],[155.83385292,17.28922066,-69.58772148],[155.83385292,-16.79897426,-69.58772148],[148.87980461,63.0843668,-67.08338569],[140.25179004,115.2759602,-66.47558436],[134.81114026,172.23277812,-66.4082809],[140.02229774,149.59502649,66.82940978],[148.87980461,-62.5941204,67.43145989],[140.25179004,-114.7857138,66.82365856],[134.81114026,-171.74253171,66.7563551],[140.02229774,-149.10478009,66.82940978],[155.83385292,17.28922066,69.93579568],[155.83385292,-16.79897426,69.93579568],[148.87980461,63.0843668,67.43145989],[140.25179004,115.2759602,66.82365856],[134.81114026,172.23277812,66.7563551],[-0.22309836,-14.7548768,94.6578146],[-0.22274869,14.63416538,94.65728247],[-0.22309836,-14.7548768,33.1440371],[-0.2227494,14.63416538,33.14350606],[-0.22309836,-14.7548768,-32.7959629],[-0.22275017,14.63416538,-32.79649278],[-0.22275088,14.63416538,-94.31026919],[-0.22309836,-14.7548768,-94.3097404],[-0.22251378,14.63416538,133.67883754],[-0.22309838,0.32387283,132.95540977],[-0.22309835,-12.10959136,132.47765508],[-0.25388932,-12.14527294,-133.0188089],[-0.20468961,0.29019969,-133.50721433],[-0.27291689,14.63416538,-134.24421453],[-68.50665568,-174.3848768,-124.0338439],[-68.50665568,-174.3848768,124.3819181],[-111.6010731,-116.68147524,-108.04943674],[-111.6010731,-116.68147524,108.39751094],[-115.60155308,-172.5948768,-122.0666339],[-115.60155308,-172.5948768,122.4147081],[-117.83642808,-114.3848768,-117.97313365],[-117.83642808,-114.3848768,118.32120785],[-105.72326038,-56.44636182,-134.30464717],[-105.72326038,-56.44636182,134.65272137],[-123.28505389,-62.40311834,142.9365984],[-123.28505389,-62.40311834,-142.5885242],[-58.95263622,0.35013824,-132.56879365],[-58.99552324,0.34651634,132.95628031],[-68.50665568,174.8751232,-124.0338439],[-68.50665568,174.8751232,124.3819181],[-111.47261095,117.23904762,-107.58589433],[-111.47261095,117.23904762,107.93396853],[-115.60155308,173.0851232,-122.0666339],[-115.60155308,173.0851232,122.4147081],[-117.83642808,114.8751232,-117.97313365],[-117.83642808,114.8751232,118.32120785],[-105.79218026,57.03336338,-134.47113109],[-105.79215981,57.03333404,134.81915626],[-123.28505389,62.89336474,142.9365984],[-123.28505389,62.89336474,-142.5885242],[-94.52415043,-11.41761882,-131.53772749],[-94.46904234,-11.43864337,132.50343696],[-121.87555556,-17.24879489,132.28018265],[-121.79429871,-17.20414924,-130.87413158],[-94.66983399,14.63416538,-132.47629411],[-94.60499062,14.63416538,133.42549412],[-121.87555555,17.9956507,133.63444714],[-121.81642259,18.03816031,-132.25569253],[-96.48927736,-154.62304991,-108.82214371],[-96.48927736,-154.62304991,109.17021791],[-118.00555308,-149.7548768,-117.6838219],[-118.00555308,-149.7548768,118.0318961],[-96.11877252,155.51936399,-108.00077324],[-96.11877252,155.51936399,108.34884744],[-118.00555308,150.2451232,-117.6838219],[-118.00555308,150.2451232,118.0318961],[-87.66886439,155.51936399,-84.99470969],[-130.28253995,150.14731517,-97.14020788],[-87.91489471,-154.62304991,-85.44889847],[-130.28253995,-149.65706876,-97.14020788],[-144.51139279,17.57451591,-103.54803982],[-84.1022069,14.63416538,-91.63219015],[-144.51139279,-17.0842695,-103.54803982],[-83.99165955,-15.44177291,-91.45682456],[-138.63442328,62.86444052,-101.78062848],[-95.20724327,57.56758533,-91.08495702],[-130.57247935,114.92244857,-98.17182083],[-122.58994917,174.68950358,-95.48312701],[-102.64660156,118.96168189,-87.02402262],[-70.77500924,180.14799512,-92.88724872],[-138.63442328,-62.37419412,-101.78062848],[-95.16476042,-56.72674465,-91.49554054],[-130.57247935,-114.43220217,-98.17182083],[-122.58994917,-174.19925717,-95.48312701],[-102.5746327,-117.87750478,-86.93189306],[-70.77500924,-179.65774872,-92.88724872],[-72.83902815,-179.5029473,-32.84887872],[-102.5746327,-117.87750478,-32.7959629],[-137.39537142,-173.08622399,-30.17097309],[-149.36688813,-115.07321756,-27.2943953],[-158.01676093,-62.80443345,-27.5832773],[-95.20724322,57.5675849,-32.79596282],[-83.8792916,-15.02656967,-32.7959629],[-84.05533012,14.63416538,-32.79542282],[-87.91301023,-154.62304991,-32.7959629],[-149.1897064,149.13403034,-27.29761079],[-87.5077695,155.51936399,-32.7959629],[-149.1897064,-148.64378394,-27.29761079],[-165.26948178,17.07642011,-28.71974987],[-165.26948178,-16.58617371,-28.71974987],[-158.01676093,63.29467985,-27.5832773],[-149.36688813,115.56346396,-27.2943953],[-137.39537142,173.57647039,-30.17097309],[-102.64660156,118.96168189,-32.7959629],[-72.83902815,179.9931937,-32.84887872],[-95.16476042,-56.72674465,-32.7959629],[-149.1897064,149.13403034,27.64568499],[-87.91301023,-154.62304991,33.1440371],[-84.05532924,14.63416538,33.14457602],[-83.8792916,-15.02656967,33.1440371],[-95.20724319,57.56758466,33.14403718],[-158.01676093,-62.80443345,27.9313515],[-149.36688813,-115.07321756,27.6424695],[-137.39537142,-173.08622399,30.51904729],[-102.5746327,-117.87750478,33.1440371],[-72.83902815,-179.5029473,33.19695292],[-87.5077695,155.51936399,33.1440371],[-149.1897064,-148.64378394,27.64568499],[-165.26948178,17.07642011,29.06782407],[-165.26948178,-16.58617371,29.06782407],[-158.01676093,63.29467985,27.9313515],[-149.36688813,115.56346396,27.6424695],[-137.39537142,173.57647039,30.51904729],[-102.64660156,118.96168189,33.1440371],[-72.83902815,179.9931937,33.19695292],[-95.16476042,-56.72674465,33.1440371],[-70.77500924,-179.65774872,93.23532292],[-102.5746327,-117.87750478,87.27996726],[-122.58994917,-174.19925717,95.83120121],[-130.57247935,-114.43220217,98.51989503],[-138.63442328,-62.37419412,102.12870268],[-95.20724316,57.56758446,91.43303142],[-83.99165955,-15.44177291,91.80489876],[-84.10219656,14.63416538,91.98129164],[-87.91489471,-154.62304991,85.79697267],[-130.28253995,150.14731517,97.48828208],[-87.66886439,155.51936399,85.34278389],[-130.28253995,-149.65706876,97.48828208],[-144.51139279,17.57451591,103.89611402],[-144.51139279,-17.0842695,103.89611402],[-138.63442328,62.86444052,102.12870268],[-130.57247935,114.92244857,98.51989503],[-122.58994917,174.68950358,95.83120121],[-102.64660156,118.96168189,87.37209682],[-70.77500924,180.14799512,93.23532292],[-95.16476042,-56.72674465,91.84361474],[-140.46849446,149.59502649,-66.48133558],[-149.32600133,-62.5941204,-67.08338569],[-140.69798676,-114.7857138,-66.47558436],[-135.25733698,-171.74253171,-66.4082809],[-140.46849446,-149.10478009,-66.48133558],[-156.28004964,17.28922066,-69.58772148],[-156.28004964,-16.79897426,-69.58772148],[-149.32600133,63.0843668,-67.08338569],[-140.69798676,115.2759602,-66.47558436],[-135.25733698,172.23277812,-66.4082809],[-140.46849446,149.59502649,66.82940978],[-149.32600133,-62.5941204,67.43145989],[-140.69798676,-114.7857138,66.82365856],[-135.25733698,-171.74253171,66.7563551],[-140.46849446,-149.10478009,66.82940978],[-156.28004964,17.28922066,69.93579568],[-156.28004964,-16.79897426,69.93579568],[-149.32600133,63.0843668,67.43145989],[-140.69798676,115.2759602,66.82365856],[-135.25733698,172.23277812,66.7563551],[-0.22309836,-154.62304991,91.4119181],[-0.22309836,155.51936399,91.4119181],[-0.22309836,-179.7548768,93.1824071],[-0.22309836,180.2451232,93.1824071],[-0.22309836,-154.62304991,33.1440371],[-0.22309836,155.51936399,33.1440371],[-0.22309836,-179.7548768,33.1440371],[-0.22309836,180.2451232,33.1440371],[-0.22309836,-154.62304991,-32.7959629],[-0.22309836,155.51936399,-32.7959629],[-0.22309836,-179.7548768,-32.7959629],[-0.22309836,180.2451232,-32.7959629],[-0.22309836,-154.62304991,-91.0638439],[-0.22309836,-179.7548768,-92.8343329],[-0.22309836,155.51936399,-91.0638439],[-0.22309836,180.2451232,-92.8343329],[-0.22309836,-154.62304991,119.8023851],[-0.22309836,-154.62304991,-119.4543109],[-0.22309836,-174.3848768,-124.0338439],[-0.22309836,-174.3848768,124.3819181],[-0.22309836,155.51936399,119.8023851],[-0.22309836,155.51936399,-119.4543109],[-0.22309836,174.8751232,-124.0338439],[-0.22309836,174.8751232,124.3819181]]
  const groups = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
return {faces:faces, vertices:vertices, groups:groups}
}

const main = (params) => {
  const sc = 1, ep = params.ep *2

	//const vv = require('./' + params.v + '.obj')
	const v = volume()
	const vv = polyhedron({points:v.vertices, faces:v.faces})
  const vol = center({}, rotateX(degToRad(90), vv))
  
  let r = [], rH = [], rV = []
  let bV = measureBoundingBox(vol)

	// Recup parametres
  const pv = Object.values(params)
  const lH = pv.slice(0,10).filter(Number).map(x => (x-50)/100)
  const lV = pv.slice(10,20).filter(Number).map(x => (x-50)/100)
  
	// 1°) Traverses en X (H)
  fH = bV[1][0] - bV[0][0]
  mH = (bV[1][0] + bV[0][0]) / 2
  var trH = cuboid( {
		size: [ ep, 1+bV[1][1]- bV[0][1], 1+bV[1][2] - bV[0][2] ]} )
	for (let i = 0; i < lH.length; i++){
		var t = intersect(vol, translateX(fH * lH[i], trH))
		if (t.polygons.length > 0)
			rH.push(t)
	}

	// 2°) Traverses en Y (V)
	fV = bV[1][1] - bV[0][1]
	mV = (bV[1][1] + bV[0][1]) / 2
	var trV = cuboid( {
		size: [ 1+ bV[1][0] - bV[0][0], ep, 1+ bV[1][2] - bV[0][2] ]} )	
	for (let i = 0; i < lV.length; i++){
		var t = intersect(vol, translateY(fV * lV[i], trV))
		if (t.polygons.length > 0)
			rV.push(t)
	}
	
	// 3°) Entrecroisement
	var ur = union(intersect(union(rH), union(rV)));
	var tmp = scission3d(ur)  
	var eS = [], eH = [], eV = [];
	for(let i=0; i< tmp.length; i++){
		let p = tmp[i];
		let b = measureBoundingBox(p), 
				d = vec3.subtract(b[1], b[0]);
		let c1 = translate([b[0][0], b[0][1] + ep/2, b[0][2]], 
					cuboid({size: [d[0], d[1]*2, d[2]]}));
		let c2 = translate([b[0][0] + ep/2, b[0][1], b[1][2]], 
					cuboid({size: [d[0]*2, d[1], d[2]]}));
		
		eH.push(intersect(tmp[i], c1));
		eV.push(intersect(tmp[i], c2));
	}
	
	rH = rH.map(x=> subtract(x, eV));
	rV = rV.map(x=> subtract(x, eH));

	// 3d
	//r.push(colorize([0,1,0], translateX(-70, vol)));
	//r.push(colorize([1,0,0], translateX(32-70, rH)));
	//r.push(colorize([0,0,1], translateX(-32-70, rV)));
	
	// 2d
	
	var dk = Math.max(fV, fH) +1
	for(let ih = 0; ih < rH.length; ih++){
		let b = measureBoundingBox(rH[ih]);
		r.push(translateX(dk *ih, union(vol2surf(rH[ih], 'x', b[0][0]))))
		//r.push(translateX(dk *ih, vol2surf(rH[ih], 'x', b[0][0])))
	}
	for(let iv = 0; iv < rV.length; iv++){
		let b = measureBoundingBox(rV[iv]);
		r.push(translate([dk *iv, -dk], union(vol2surf(rV[iv], 'y', b[0][1]))))
		//r.push(translate([dk *iv, -dk], vol2surf(rV[iv], 'y', b[0][1])))
	}
		
	return r;
}
function rndColors(){return [Math.random(), Math.random(), Math.random()];}
function sortNb	(E){ // returns E numerically sorted and deduplicated
	return E.sort(function(a, b) {return a-b}).filter(
	    function(item, pos, ary) {return !pos || item != ary[pos - 1]});
}
function scission3d	(geom){
  var i, Pl, j, i1, j1, ok, ti, tj, z, 
  zz = [], P, RScission, til, tjl, tii1, zzl, zzdl;
// construit table de correspondance entre Polygones (P)
// build polygons lookup table
  //P = geom.toPolygons();
  P = geom.polygons;
  
  RScission = [];
  Pl = P.length;
  for (i = 0; i < Pl; i++){
	ti = P[i].vertices;
	z = [];
	for (j = 0; j < Pl; j++){
      tj = P[j].vertices;
	  ok = false;
	  for (i1 = 0; i1 < ti.length; i1++){
	    tii1 = ti[i1];
		for(j1 = 0; j1 < tj.length; j1++)
		  if (!ok)ok = vec3.distance(tii1, tj[j1]) < 0.01;
	  }
	  if (ok)z.push(parseInt(j));
	}
	z = sortNb(z);
	zz.push({e:0, d:z});
  }

// regroupe les correspondances des polygones se touchant
// boucle ne s'arrêtant que quand deux passages retournent le même nb de polygones
// merge lookup data from linked polygons as long as possible
  ok = false;
  nElOk = 0;
  do {
    lnElOk = nElOk;
	nElOk = 0;
	for (i = 0; i < zz.length; i++){
	  if (zz[i].e >= 0) {
	    nElOk++;
		for (j = 0; j < zz[i].d.length; j++){
		  a = zz[i].d[j];
		  if (zz[a].e >= 0)
		    if (i != a) {
			  zz[i].d = sortNb(zz[i].d.concat(zz[a].d));
			  zz[a].e = -1;
			}
		}
	  }
	}
	ok = lnElOk == nElOk;
  }while (!ok);

// construit le tableau des CSG à retourner
// build array of CSG to return
  for (i = 0, zzl = zz.length; i < zzl; i++) {
    if (zz[i].e >= 0) {
			z = [];
			for (j = 0, zzdl = zz[i].d.length; j < zzdl; j++){
				z.push(P[zz[i].d[j]]);
			}
			if(z.length > 0) {
			RScission.push(geom3.create(z));
			}
	  }
  }

  return RScission;
}
function vol2surf(vol, axe, orig = 0){ // axe = 'x' | 'y' | 'z'
// retourne la surface formee par le volume avec l'axe z (à 0)
let S = [];
let X, Y, Z;

for(let n = 0; n < vol.polygons.length; n++){
  let pts = [];
  let P = vol.polygons[n];
  let ok = true;
  switch(axe){
		case 'x':
			X = 1; Y = 2; Z = 0;
			break;
		case 'y':
			X = 0; Y = 2; Z = 1;
			break;
		case 'z':
			X = 0; Y = 1; Z = 2;
			break;
	}
  for(let i=0; (i < P.vertices.length) && ok; i++){
    let pt = P.vertices[i];
    if(Math.abs(pt[Z] - orig)< 0.05){
      pts.push([pt[X], pt[Y]]);
    } else {
      ok = false;
    }
  }
  if (ok){
    if(axe == 'x'){
			S.push(polygon({points:pts.reverse()}));
		} else {
			S.push(polygon({points:pts}));
		}
  }
}

return S;
}

module.exports = { main, getParameterDefinitions }
